name: macOS Build Validation

on:
  push:
    branches: [ "mac/main", "mac/*" ]

permissions: {}

jobs:
  build:
    name: Unsigned Build (macOS)
    runs-on: macos-26
    permissions:
      contents: read
    steps:
      - name: Checkout with submodules
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
        with:
          submodules: recursive
          persist-credentials: false

      - name: Install Go for WireGuardKit
        run: brew install go@1.25

      - name: Install XcodeGen
        run: brew install xcodegen

      - name: Generate Xcode project
        run: xcodegen generate

      - name: Build (unsigned)
        run: |
          set -o pipefail
          xcodebuild build \
            -scheme "Phantom-WG-MacOS" \
            -destination 'platform=macOS,arch=arm64' \
            CODE_SIGNING_ALLOWED=NO \
            2>&1 | xcpretty --color
